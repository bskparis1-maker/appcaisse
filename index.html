<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>BSK - Caisse & Gestion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-container">
    <!-- ============ HEADER ============ -->
    <header class="header">
      <img src="logo.png" alt="Logo BSK" class="logo" />
      <div>
        <h1>BSK - Caisse</h1>
        <p class="subtitle">Caisse, stock, clients & bar √† parfum</p>
      </div>
    </header>

    <!-- ============ NAVIGATION ============ -->
    <nav>
  <button onclick="showView('caisse')">Caisse</button>
  <button onclick="showView('ventes')">Ventes</button>
  <button onclick="showView('clients')">Clients</button>
  <button onclick="showView('produits')">Produits</button>
  <button onclick="showView('dashboard')">Tableau de bord</button>
  <button onclick="showView('frais')">Frais</button>
  <button onclick="showView('bar-parfum')">Bar √† parfum</button>
</nav>

    <!-- ============ VUE CAISSE ============ -->
    <section id="view-caisse" class="view">
      <h2>Caisse</h2>

      <!-- Promo -->
      <div class="payment-section">
        <h3>Mode promo & Vente en gros</h3>
        <button class="secondary-btn" onclick="openPromoModal()">
          Activer / r√©gler la promo
        </button>
        <label style="display:block; margin-top:8px;">
          <input type="checkbox" id="wholesale-mode" />
          Vente en gros (prix personnalis√©s, remises d√©sactiv√©es)
        </label>
      </div>

      <!-- Produits -->
      <h3>Produits</h3>
      <div id="products-list"></div>

      <!-- Panier -->
      <h3>Panier</h3>
      <div id="cart-list">Panier vide.</div>
      <p class="total-label">
        Total : <strong><span id="cart-total">0</span> FCFA</strong>
      </p>

      <!-- Remise & paiement -->
      <div class="payment-section">
        <h3>Paiement & remise</h3>

        <label>
          Mode de paiement :
          <select id="payment-method">
            <option value="cash">Esp√®ces</option>
            <option value="orange">Orange Money</option>
            <option value="wave">Wave</option>
          </select>
        </label>

        <div class="discount-box">
          <label>
            Remise (FCFA) :
            <input type="number" id="cart-discount" value="0" min="0" />
          </label>
          <label>
            Raison de la remise :
            <input
              type="text"
              id="cart-discount-reason"
              placeholder="Ex : geste commercial, famille‚Ä¶"
            />
          </label>
        </div>
      </div>

      <!-- Client -->
      <h3>Client</h3>
      <div>
        <label for="client-select">Compte client :</label>
        <select id="client-select"></select>
        <button class="secondary-btn" onclick="openAddClientModal()">
          Nouveau client
        </button>
      </div>

      <!-- Actions caisse -->
      <div style="margin-top:12px;">
        <button class="primary-btn" onclick="confirmSale()">
          Valider la vente
        </button>
        <button class="secondary-btn" onclick="printTicket()">
          Imprimer le ticket
        </button>
        <button class="danger-btn" onclick="clearCart()">
          Annuler le panier
        </button>
      </div>
    </section>

    <!-- ============ POPUP PROMO ============ -->
    <div
      id="promo-popup"
      class="view hidden"
      style="
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
      "
    >
      <div
        style="
          background: #ffffff;
          padding: 16px 18px;
          border-radius: 12px;
          max-width: 360px;
          width: 100%;
          box-shadow: 0 15px 35px rgba(15, 23, 42, 0.3);
        "
      >
        <h3>Configurer la promo</h3>
        <p style="font-size:13px; color:#4b5563; margin-top:4px;">
          D√©finis les prix promo pour les articles √† 8 000 FCFA et 5 000 FCFA,
          ainsi que la p√©riode de la promotion.
        </p>

        <div class="discount-box">
          <label>
            Nouveau prix pour les produits √† 8 000 FCFA :
            <input type="number" id="promo-8000" min="0" />
          </label>
          <label>
            Nouveau prix pour les produits √† 5 000 FCFA :
            <input type="number" id="promo-5000" min="0" />
          </label>
          <label>
            Date de d√©but :
            <input type="date" id="promo-start" />
          </label>
          <label>
            Date de fin :
            <input type="date" id="promo-end" />
          </label>
        </div>

        <div style="margin-top:10px;">
          <button class="primary-btn" onclick="savePromo()">Enregistrer</button>
          <button class="secondary-btn" onclick="closePromoPopup()">
            Fermer
          </button>
        </div>
      </div>
    </div>

    <!-- ============ VUE VENTES ============ -->
    <section id="view-ventes" class="view hidden">
      <h2>Ventes</h2>

      <div class="payment-section">
        <h3>Ventes du jour</h3>
        <label>
          Date :
          <input
            type="date"
            id="sales-date"
            onchange="updateSalesViewForSelectedDate()"
          />
        </label>
        <button class="secondary-btn" onclick="updateSalesViewForSelectedDate()">
          Actualiser
        </button>
        <button class="secondary-btn" onclick="refreshSalesFromSheet()">
          Recharger depuis Google Sheets
        </button>
	<button class="primary-btn" onclick="openDailyReportForSelectedDate()">
  Rapport du jour (PDF)
</button>
        <div id="sales-debug" style="font-size:12px; color:#6b7280; margin-top:4px;"></div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Heure</th>
            <th>Produits</th>
            <th>Montant</th>
            <th>Paiement</th>
            <th>Client / Actions</th>
          </tr>
        </thead>
        <tbody id="sales-table-body"></tbody>
      </table>
    </section>

    <!-- ============ VUE CLIENTS ============ -->
    <section id="view-clients" class="view hidden">
      <h2>Clients</h2>

      <input
        type="text"
        id="client-search"
        placeholder="Rechercher un client (nom ou t√©l√©phone)‚Ä¶"
        oninput="renderClientsTable()"
      />

      <div style="margin-top:6px; margin-bottom:8px;">
        <button class="primary-btn" onclick="openAddClientModal()">
          Ajouter un client
        </button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Nom</th>
            <th>T√©l√©phone</th>
            <th>Total achats</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="clients-table-body"></tbody>
      </table>
    </section>

    <!-- ============ VUE PRODUITS (STOCK) ============ -->
    <section id="view-produits" class="view hidden">
      <h2>Produits & Stock</h2>

      <p style="font-size:13px; color:#4b5563;">
        Gestion du stock des produits (caisse principale). Toute modification
        manuelle du stock demande un motif et est enregistr√©e dans l'historique.
      </p>

      <!-- Tableau principal des produits -->
      <table>
        <thead>
          <tr>
            <th>Nom</th>
            <th>Prix (FCFA)</th>
            <th>Stock actuel</th>
            <th>Nouveau stock</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="products-table-body"></tbody>
      </table>

      <h3 style="margin-top:24px;">Historique des mouvements de stock</h3>
      <p style="font-size:13px; color:#4b5563;">
        Les changements de stock manuels sont list√©s ci-dessous
        (date, ancien stock, nouveau stock, variation et motif).
      </p>

      <!-- üîé Filtres de date pour l'historique -->
      <div class="dashboard-filters">
        <div>
          <label>
            Du :
            <input
              type="date"
              id="stock-history-start"
              onchange="renderStockHistoryTable()"
            />
          </label>
          <label>
            au :
            <input
              type="date"
              id="stock-history-end"
              onchange="renderStockHistoryTable()"
            />
          </label>
        </div>
        <div class="dashboard-quick">
          <button class="secondary-btn" onclick="setStockHistoryRangeToday()">
            Aujourd'hui
          </button>
          <button class="secondary-btn" onclick="setStockHistoryRangeWeek()">
            Cette semaine
          </button>
          <button class="secondary-btn" onclick="setStockHistoryRangeMonth()">
            Ce mois
          </button>
          <button class="secondary-btn" onclick="setStockHistoryRangeYear()">
            Cette ann√©e
          </button>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Date / Heure</th>
            <th>Produit</th>
            <th>Ancien stock</th>
            <th>Nouveau stock</th>
            <th>Variation</th>
            <th>Motif</th>
          </tr>
        </thead>
        <tbody id="stock-history-body"></tbody>
      </table>
    </section>
    <!-- ============ VUE TABLEAU DE BORD ============ -->
    <section id="view-dashboard" class="view hidden">
      <h2>Tableau de bord</h2>

      <div class="dashboard-filters">
        <div>
          <label>
            Du :
            <input type="date" id="dashboard-start" onchange="loadDashboardStats()" />
          </label>
          <label>
            au :
            <input type="date" id="dashboard-end" onchange="loadDashboardStats()" />
          </label>
        </div>
        <div class="dashboard-quick">
          <button class="secondary-btn" onclick="setDashboardRangeToday()">
            Aujourd'hui
          </button>
          <button class="secondary-btn" onclick="setDashboardRangeWeek()">
            Cette semaine
          </button>
          <button class="secondary-btn" onclick="setDashboardRangeMonth()">
            Ce mois
          </button>
          <button class="secondary-btn" onclick="setDashboardRangeYear()">
            Cette ann√©e
          </button>
        </div>
      </div>

      <div class="dashboard-summary">
        <div class="card">
          <div class="label">Chiffre d'affaires</div>
          <div class="value"><span id="db-total">0</span> FCFA</div>
        </div>
        <div class="card">
          <div class="label">Nombre de ventes</div>
          <div class="value" id="db-count">0</div>
        </div>
        <div class="card">
          <div class="label">Panier moyen</div>
          <div class="value"><span id="db-average">0</span> FCFA</div>
        </div>
        <div class="card">
          <div class="label">Remises totales</div>
          <div class="value"><span id="db-discount">0</span> FCFA</div>
        </div>
        <div class="card">
          <div class="label">Esp√®ces</div>
          <div class="value"><span id="db-cash">0</span> FCFA</div>
        </div>
        <div class="card">
          <div class="label">Orange Money</div>
          <div class="value"><span id="db-orange">0</span> FCFA</div>
        </div>
        <div class="card">
          <div class="label">Wave</div>
          <div class="value"><span id="db-wave">0</span> FCFA</div>
        </div>
      </div>

      <div style="margin-top:18px;">
        <canvas id="dashboard-chart" width="400" height="200"></canvas>
      </div>
    </section>

    <!-- ============ VUE FRAIS ============ -->
    <section id="view-frais" class="view hidden">
      <h2>Frais</h2>

      <p style="font-size:13px; color:#4b5563;">
        Enregistre ici les d√©penses (motif + montant). Chaque d√©pense est dat√©e
        et appara√Æt dans l'historique ci-dessous.
      </p>

      <h3>Nouvelle d√©pense</h3>
      <div class="payment-section">
        <div class="discount-box">
          <label>
            Motif de la d√©pense :
            <input
              type="text"
              id="expense-label"
              placeholder="Ex : Loyer boutique, Fournisseur, Transport..."
            />
          </label>
          <label>
            Montant (FCFA) :
            <input
              type="number"
              id="expense-amount"
              min="0"
              placeholder="0"
            />
          </label>
        </div>
        <button class="primary-btn" onclick="addExpense()">
          Valider la d√©pense
        </button>
      </div>

      <h3>Historique des frais</h3>
      <p style="font-size:13px; color:#4b5563;">
        Filtre les d√©penses par p√©riode : aujourd'hui, cette semaine, ce mois,
        cette ann√©e, ou avec un intervalle de dates personnalis√©.
      </p>

      <div class="dashboard-filters">
        <div>
          <label>
            Du :
            <input
              type="date"
              id="expense-history-start"
              onchange="renderExpensesTable()"
            />
          </label>
          <label>
            au :
            <input
              type="date"
              id="expense-history-end"
              onchange="renderExpensesTable()"
            />
          </label>
        </div>
        <div class="dashboard-quick">
          <button class="secondary-btn" onclick="setExpenseHistoryRangeToday()">
            Aujourd'hui
          </button>
          <button class="secondary-btn" onclick="setExpenseHistoryRangeWeek()">
            Cette semaine
          </button>
          <button class="secondary-btn" onclick="setExpenseHistoryRangeMonth()">
            Ce mois
          </button>
          <button class="secondary-btn" onclick="setExpenseHistoryRangeYear()">
            Cette ann√©e
          </button>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Date / Heure</th>
            <th>Motif</th>
            <th>Montant (FCFA)</th>
          </tr>
        </thead>
        <tbody id="expense-history-body"></tbody>
      </table>
    </section>

    <!-- ============ VUE BAR √Ä PARFUM ============ -->
    <section id="view-bar-parfum" class="view hidden">
      <h2>Bar √† parfum</h2>
      <p style="font-size:13px; color:#4b5563;">
        Indique le niveau de chaque r√©f√©rence (1L ou plus, 0,5L, rupture).
        Les couleurs se mettent √† jour automatiquement.
      </p>

      <table>
        <thead>
          <tr>
            <th>R√©f√©rence</th>
            <th>Niveau</th>
          </tr>
        </thead>
        <tbody id="perfume-table-body"></tbody>
      </table>
    </section>
  </div>

  <!-- Librairie Chart.js pour le graphique du tableau de bord -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Ton code -->
  <script src="app.js"></script>
</body>
</html>